# doma2samplekotlin
Doma2+SpringBoot+Gradle+Kotlinでやっていくときのアレコレ

## パッケージごとの役割
Doma2+Spring BootでDDD x CQRSをやりたい。  
そのためのクラス設計を考える。  

### dao
doma2にアクセスするためのクラス。  
ここのベストプラクティス通りにJavaでやる。  
https://doma.readthedocs.io/en/stable/kotlin-support/

### config
JavaConfig的なものはここにまとめておいておく。  

### controller
Springのコントローラを置く。  
ドメイン毎の各サービスをここで叩く。  
ひとつのメソッドが、ひとつのユースケースに対応するようにする。  

### model
ドメインモデルを格納する。  
読み込み用と書き込み用のエンティティに分ける。  
本当はテーブルと対応したエンティティのみにしたいが、複数のテーブルのJOINなどでテーブルとは異なるデータを扱いたい場合がある。  
こうしたときに、読み込み用と書き込み用のエンティティに分けると扱いやすい。  

同じ項目を持つエンティティが複数できるので、ドメインロジックが重複するかもしれない。  
それぞれの項目の独自型を定義すればよさそうだが、どこまでやるかは別途考えないとダメそう。  

### service
コントローラから直接触るクラス。  
なので、ここがインタフェースのDTOを知っていてもよいということにする。  
今のところひとつのドメインにひとつのサービスクラスにしているが、複数のドメインにまたがるユースケースをどうするか検討中。  
(ドメインごとにトランザクションを切るか、全部で切るか…)  

### dto
RESTで受け渡しされるインタフェースを定義する。  
modelと別にしている理由は2つ。  
* ドメインモデルの変更の影響をここまで伝えたくない  
* レコード数が欲しいなど、DBからのselect結果が必ずしも一致しないパターンがある  

## repositoryもあったほうが良いかも？
DBへのアクセスに使用するライブラリを意識しなくてよいように、サービスとDAOの間にrepositoryを設けても良い気がする。  
Doma2をほかのライブラリに変更したときにrepository配下を差し替えればよいので影響が限定的になる。  